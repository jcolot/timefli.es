<div>
    <a id="twitter-button">Tweet</a>
</div>

<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(setTwitterIntent, function() {
        const twitterButton = document.getElementById('twitter-button');    
        twitterButton.addEventListener('click', function() {
            alert("You need to allow access to geolocation to use this button.");
        });
    });
  } else {
    const twitterButton = document.getElementById('twitter-button');    
    twitterButton.addEventListener('click', function() {
        alert("Geolocation is not supported by this browser.");
    });
  }
}

function setTwitterIntent(position) {
    const latLng = position.coords.latitude + '%2C' + position.coords.longitude;
    const url = "https://twitter.com/intent/tweet?text=%40timefli_es%0aTwitted%20from%20" + latLng;
    const twitterButton = document.getElementById('twitter-button');    
    twitterButton.setAttribute('href', url);
    twttr.widgets.load();
}

setInterval(getLocation(), 5000);
</script>

